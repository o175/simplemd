<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta charset="UTF-8">

        <title>Просмотр товара</title>

        <style type="text/css">
            /* все элементы VBox'a с шириной во всю строку */
            #myView2--idVBox > div {
                width: 100%;
            }
        </style>

        <!-- src="https://openui5.hana.ondemand.com/resources/sap-ui-core.js" -->

        <script
            id="sap-ui-bootstrap"
            type="text/javascript"
            src="https://sapui5.hana.ondemand.com/sdk/resources/sap-ui-core.js"
            data-sap-ui-theme="sap_belize"
            data-sap-ui-libs="sap.m"
            data-sap-ui-xx-bindingSyntax="complex"
        >
        </script>

        <!-- Страница выбора категории -->
        <script id="view1" type="sapui5/xmlview" >
            <mvc:View
                controllerName="local.controller.Master"
                xmlns="sap.m"
                xmlns:sap.ui.core="sap.ui.core"
                xmlns:mvc="sap.ui.core.mvc" >
                <Page id="page" title="Выбор категории" showFooter="true">
                    <headerContent>
                        <Button icon="sap-icon://cart" tooltip="Добавить в корзину" />
                    </headerContent>
                    <subHeader>
                        <Toolbar id="searchBar" >
                            <content>
                                <SearchField id="searchField" width="100%" search="onCategorySearch" placeholder="Поиск ..." showRefreshButton="true" />
                            </content>
                        </Toolbar>
                    </subHeader>

                    <content>
                        <List id="categoryList" noDataText="Нет данных" items="{/categories}">
                            <items>
                                <StandardListItem counter="{count}" title="{name}"/>
                            </items>
                        </List>
                    </content>
                    <footer>
                        <Toolbar>
                            <content>
                                <ToolbarSpacer />
				<Button press="onAddCategory"
                                        icon="sap-icon://add" />
                            </content>
                        </Toolbar>
                    </footer>
                </Page>
            </mvc:View>
        </script>

        <!-- Детальная страница -->
        <script id="view2" type="sapui5/xmlview">
            <mvc:View
                controllerName="local.controller.Detail"
                xmlns="sap.m"
                xmlns:sap.ui.core="sap.ui.core"
                xmlns:mvc="sap.ui.core.mvc" >
                <Page id="page" navButtonPress="handleNavButtonPress" title="{Name}" showNavButton="{device>/isPhone}">
                    <content>
                        <ObjectHeader title="Laptop Case" number="78.99" numberUnit="EUR" introActive="false" titleActive="false" iconActive="false">
                            <attributes>
                                <ObjectAttribute text="Red point stories" active="false" />
                                <ObjectAttribute text="Laptop Case with many room for pencils and other stationaries" active="false" />
                                <ObjectAttribute text="789g" active="false" />
                            </attributes>
                            <firstStatus>
                                <ObjectStatus text="Доступен" state="Success" />
                            </firstStatus>
                        </ObjectHeader>
                        <VBox id="idVBox" direction="Column" alignItems="Center">
                            <items>
                                <IconTabBar
                                    expanded="true"
                                    width="100%"
                                    id="idIconTabBar"
                                    class="sapUiResponsiveContentPadding">
                                    <items>
					<IconTabFilter
                                            icon="sap-icon://begin"
                                            iconColor="Positive"
                                            design="Horizontal"
                                            count="7 из 14"
                                            text="Confirm Ok"
                                            key="Ok">
					    <content>
						<List >
						    <headerToolbar>
							<Toolbar>
							    <Title text="Продукты" level="H2" />
							    <ToolbarSpacer />
							    <Button
								icon="sap-icon://settings"
								press="handleButtonPress" />
							    <Button
								icon="sap-icon://person-placeholder"
								press="handleButtonPress" />
							    <Button
								icon="sap-icon://drop-down-list"
								press="handleButtonPress" />
							</Toolbar>
						    </headerToolbar>
						    <infoToolbar>
							<Toolbar
							    active="true"
							    press="handleInfobarPress" >
							    <Label text="This is the info bar" />
							</Toolbar>
						    </infoToolbar>
						    <items>
							<StandardListItem
							    title = "Power Projector 4713"
							    description = "1239102"
							    icon = "https://sapui5.hana.ondemand.com/sdk/test-resources/sap/ui/demokit/explored/img/HT-6100.jpg"
							    iconDensityAware="false"
							    iconInset="false" />

							<StandardListItem
							    title = "Gladiator MX"
							    description = "2212-121-828"
							    icon = "https://sapui5.hana.ondemand.com/sdk/test-resources/sap/ui/demokit/explored/img/HT-1071.jpg"
							    iconDensityAware="false"
							    iconInset="false" />


							<StandardListItem
							    title = "Hurricane GX"
							    description = "K47322.1"
							    icon = "https://sapui5.hana.ondemand.com/sdk/test-resources/sap/ui/demokit/explored/img/HT-1072.jpg"
							    iconDensityAware="false"
							    iconInset="false" />

							<StandardListItem
							    title = "Webcam"
							    description = "22134T"
							    icon = "https://sapui5.hana.ondemand.com/sdk/test-resources/sap/ui/demokit/explored/img/HT-1112.jpg"
							    iconDensityAware="false"
							    iconInset="false" />
						    </items>
						</List>
					    </content>
					</IconTabFilter>
					<IconTabSeparator icon="sap-icon://open-command-field" />
					<IconTabFilter
                                            icon="sap-icon://compare"
                                            iconColor="Critical"
                                            design="Horizontal"
                                            count="5 из 14"
                                            text="Check Heavys"
                                            key="Heavy" />
					<IconTabSeparator icon="sap-icon://open-command-field" />
					<IconTabFilter
                                            icon="sap-icon://inventory"
                                            iconColor="Negative"
                                            design="Horizontal"
                                            count="2 из 14"
                                            text="Claim Overweights"
                                            key="Overweight" />
                                    </items>
                                </IconTabBar>
                            </items>
                        </VBox>

                    </content>
                    
                    <footer>
                        <Toolbar>
                            <content>
                                <ToolbarSpacer />
                                <Button text="Добавить в корзину" icon="sap-icon://add" />
                            </content>
                        </Toolbar>
                    </footer>
                </Page>
            </mvc:View>
        </script>
	
        <script id="dialogFragment" type="ui5/fragment">
            <core:FragmentDefinition
                xmlns="sap.m"
                xmlns:core="sap.ui.core"
                xmlns:l="sap.ui.layout"
                xmlns:f="sap.ui.layout.form"
		xmlns:mvc="sap.ui.core.mvc"
		xmlns:html="http://www.w3.org/1999/xhtml"
                >
                <Dialog
                    id="addCategoryDialog"
		    ok="onAddCategorySubmit"
		    cancel="onCloseDialog"
                    title="Создать категорию:">
                    <content>
                        <f:SimpleForm class="editableForm">
                            <f:content>
                                <Label text="Название" />
                                <Input id="newCategoryName" />
                                <Label text="Количество" />
                                <Input id="newCategoryCount" value="1" type="Number" />
                            </f:content>
                        </f:SimpleForm>
			
		    </content>
		    <beginButton>
			<Button text="Создать" press="onAddCategorySubmit"/>
		    </beginButton>
		    <endButton>
			<Button text="Отмена" press="onCloseDialog"/>
		    </endButton>
		</Dialog>
            </core:FragmentDefinition>
        </script>
        <!-- Подключение страниц -->
        <script>
         // Controller definition 4 Matser
         sap.ui.controller("local.controller.Master", {
           onInit: function (oEvent) {
             this.oModel = new sap.ui.model.json.JSONModel();
             this.oModel.setData({
               categories : [
                 { name: "категория 1", count: 4, id: 0 },
                 { name: "категория 2", count: 2, id: 1 },],
	       uId : 2,
	     });
             this.getView().setModel(this.oModel);
	     this.categoryList = this.getView().byId("categoryList");
           },
	   onCategorySearch: function(oEvent) {
	     var Filter = sap.ui.model.Filter;
	     var FilterOperator = sap.ui.model.FilterOperator;
	     // build filter array
	     var aFilter = [];
	     var sQuery = oEvent.getParameter("query").trim();
	     if (sQuery) {
	       aFilter.push(new Filter("name", FilterOperator.Contains, sQuery));
	     };
	     var oBinding = this.categoryList.getBinding("items");
	     oBinding.filter(aFilter);
	   },
	   getCategoryFields: function(name, count) {
	     var _count = parseInt(count);
	     if (name && _count){
	       return {name: name, count: _count}
	     } else {
	       alert("Некорректные данные!");
	       return false;
	     }
	   },
           onCloseDialog: function() {
             this.oDialog.close();
           },
	   onAddCategorySubmit: function() {
             var count = sap.ui.getCore().byId("newCategoryCount").getValue();
             var name = sap.ui.getCore().byId("newCategoryName").getValue();
             count = count.replace(/^D/,"");
	     var validated = this.getCategoryFields(name, count);
	     if (validated) {
	       var id = this.oModel.getProperty("/uId");
	       this.oModel.setProperty("/uId", id+1);
               this.oModel.getProperty("/categories").push({name: validated.name, count: validated.count, id: id});
               this.oModel.refresh();
	       this.oDialog.close();
	     }
	   },
           onAddCategory: function(oEvent) {
             oView=this.getView();
             this.oDialog = sap.ui.getCore().byId("addCategoryDialog");
             if (!this.oDialog) {
               this.oDialog = sap.ui.xmlfragment({ fragmentContent : jQuery("#dialogFragment").html()},this);
               oView.addDependent(this.oDialog);
             }
             this.oDialog.open();
           },
           pressExample: function(oEvent) {
             alert('Нажат элемент '+oEvent.getSource().getTitle());
           }
         });

         // Controller definition 4 Detail
         sap.ui.controller("local.controller.Detail", {

         });

         var splitApp = new sap.m.SplitApp({
           masterPages: [sap.ui.xmlview("myView1", {viewContent:jQuery('#view1').html()})],
           detailPages: [sap.ui.xmlview("myView2", {viewContent:jQuery('#view2').html()})]
         });

         var shell = sap.m.Shell({
           showLogout:false,
           app:splitApp
         })

         // oView.setModel(new sap.ui.model.json.JSONModel("https://openui5.hana.ondemand.com/test-resources/sap/ui/demokit/explored/products.json"));

         shell.placeAt('content');
        </script>

    </head>

    <body class="sapUiBody" role="application">
        <div id="content"></div>
    </body>
</html>
